<!DOCTYPE html>
<html>
    <head>
        <% include include/head.ejs %>
        <title>Buscas</title>
        <style>.card{ margin-bottom: 8px}</style>
    </head>         
    <body>
        <% include include/header.ejs %>
        <main class="form container">
                <h2><%= string%></h2>
                <% if(retorno.length == 0){ %>
                    <h2>Nada Encotrado :(</h2>    
                <% } %>
                <% for(var i=0; i < retorno.length; i++){ %>
                    <div class="card">
                        <div class="card-header">
                        <p>Título: <%= retorno[i].title %> </p>
                        </div>
                        <div class="card-body">
                            <p>Descrição: <%= retorno[i].description%></p>
                            <p>Data upload: <%= retorno[i].createdAt%></p>
                            <button class="btn btn-success down" pdf="<%=retorno[i].id %>">Download</button>
                            <a class="btn btn-danger" href="/api/delete/<%=retorno[i].id %>">Excluir</a>

                        </div>
                    </div>
                <% } %>
        </main>
        <% include include/footer.ejs %>
        <% include include/scripts.ejs %>
    </body>
    <script src="http://danml.com/js/download.js"></script>
    <script>
    $( document ).ready(function(){
        $('.down').on('click', function(){
            var link = $(this).attr('pdf');

            $.ajax({
                type: "GET",
                url: '/api/getPdf/' + link,
                success: function(data){
                    console.log('CHEGOU',data);
                    $.ajax({
                        type: "GET",
                        url: 'http://' + data,
                        success: download.bind(true, "application/pdf", "teste.pdf"),
                        fail: function(err){
                            console.log('err', err)
                        },
                        xhrFields: {
                            responseType: 'blob'
                        }
                    });
                },
            });
        })
    })
    </script>
</html>